pkgname=tux-control
pkgver=0.0.1
pkgdesc="TUX Control."
pkgrel=1
arch=('any')
backup=('etc/tux-control/config.yml')
license=('GPL-3')
url='https://gitlab.salamek.cz/sadam/tux-control'
#source=('tux-control::git+ssh://git@gitlab.salamek.cz/sadam/tux-control.git')
#md5sums=('SKIP')
install=tux_control.install
makedepends=('python-setuptools' 'npm')
depends=(
    'sudo'
    'postgresql'
    'python'
    'rabbitmq'
    'python-flask'
    'python-babel'
    'python-yaml'
    'python-flask-socketio'
    'python-socketio'
    'python-flask-migrate'
    'python-celery'
    'python-raven'
    'python-docopt'
    'python-eventlet'
    'python-flask-celery-helper'
    'python-flask-babel'
    'python-psycopg2'
)

conflicts=(
)

optdepends=(
)

prepare() {
  mkdir -p "${srcdir}/${pkgname}"
  cp -R "${srcdir}/../../etc" "${srcdir}/${pkgname}"
  cp -R "${srcdir}/../../lib" "${srcdir}/${pkgname}"
  cp -R "${srcdir}/../../tux_control" "${srcdir}/${pkgname}"
  cp -R "${srcdir}/../../tests" "${srcdir}/${pkgname}"
  cp -R "${srcdir}/../../setup.py" "${srcdir}/${pkgname}"
  cp -R "${srcdir}/../../requirements.txt" "${srcdir}/${pkgname}"
  cp -R "${srcdir}/../../README.md" "${srcdir}/${pkgname}"
}


build() {
  cd "${srcdir}/${pkgname}/tux_control/static"
  npm i
}

package() {
  cd "${srcdir}/${pkgname}"
  python setup.py install --root="$pkgdir/" --optimize=1
}
